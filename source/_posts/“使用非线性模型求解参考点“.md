---
title: 使用非线性模型求解参考点                 
date: 2025-12-10 11:26:13
tags:
categories:
- 车辆动力学
---

# 四轮转向车模型
假设车辆是一个“自行车”结构（左右轮合并），只考虑侧向运动 $V_y$ 和 横摆运动 $r$。

1. **侧向力平衡**
$$
m a_y = \sum F_y
$$
其中车辆的侧向绝对加速度 $a_y$ 由侧向加速度 $\dot{V}_y$ 和向心加速度 $r V_x$ 组成：
$$m (\dot{V}_y + r V_x) = F_{yf} \cos\delta_f + F_{yr} \cos\delta_r$$

2. **横摆力矩平衡**
$$
I_z \dot{r} = \sum M_z 
$$

$$
I_z \dot{r} = l_f F_{yf} \cos \delta_f - l_r F_{yr} \cos \delta_r
$$

**稳态 (Steady State)** 的定义是车辆进入稳定转向状态，此时状态变量不再变化：
$$\dot{V}_y = 0, \quad \dot{r} = 0$$

所以：需要求解的**平衡点方程**就是：
$$\begin{cases}
m r V_x = F_{yf} \cos \delta_f + F_{yr} \cos \delta_r \\
0 = l_f F_{yf} \cos \delta_f - l_r F_{yr} \cos \delta_r
\end{cases}$$

## 线性模型
线性之所以是线性，就是大量使用了**小角度近似**
$$
\tan \theta \approx \theta
$$

所以：
$$
\alpha_f \approx \delta_f - \dfrac{V_y + l_f r}{V_x}
$$

$$
\alpha_r \approx \delta_r - \dfrac{V_y - l_r r}{V_x}
$$

另外假设轮胎处于线性区，侧向力与侧偏角成正比。
$$F_{yf} = C_f \alpha_f$$

$$F_{yr} = C_r \alpha_r$$

还假设了转角较小，也就是：
$$
\cos \delta_f \approx 1
$$

$$
\sin \delta_f \approx 0
$$

将以上这些线性轮胎力和近似后的侧偏角代入平衡方程：

1. **力矩平衡** $I_z \dot{r} = 0$
$$
l_f C_f \alpha_f - l_r C_r \alpha_r = 0
$$

2. **侧向力平衡** $m \dot{V_y} = 0$
$$m r V_x = C_f \alpha_f + C_r \alpha_r$$

通过联立这两个方程，消去 $V_y$，可以推导出横摆角速度 $r$ 的解析解。

定义稳定性因数 $K_s$ (Stability Factor)：
$$K_s = \frac{m}{L^2} (\frac{l_f}{C_r} - \frac{l_r}{C_f})$$
其中 $L = l_f + l_r$。

最终得到的**稳态横摆角速度增益**公式为：
$$r = \frac{V_x / L}{1 + K_s V_x^2} (\delta_f - \delta_r)$$

## 非线性模型
非线性模型之所以被称为“非线性”，是因为轮胎侧向力 $F_y$ 与侧偏角 $\alpha$ 的关系是非线性的。

首先是轮胎侧偏角，是轮胎速度矢量与轮胎朝向之间的夹角。
$$
\alpha_f = \delta_f - \theta_{vf} = \delta_f - \arctan(\frac{V_y + l_f r}{V_x})
$$

$$
\alpha_r = \delta_r - \theta_{vr} = \delta_r - \arctan(\frac{V_y - l_r r}{V_x})
$$

其次是轮胎力模型，采用了简化的魔术公式 Pacejka：
$$F_y = D \sin(C \arctan(B \alpha))$$
这是一个饱和函数：当 $\alpha$ 较小时，力线性增加；当 $\alpha$ 很大时，力会达到峰值 $D = \mu F_z$ 并饱和。

**由于 $F_y(\alpha)$ 是非线性的，上面的平衡方程组变成了一个超越方程组，无法直接写出 $V_y$ 和 $r$ 的解析解（公式解）。**

# 非线性模型的求解
为了求解出非线性模型的解，有一个大致的思路：
```mermaid
graph TD
    %% 节点样式定义
    classDef input fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,rx:5,ry:5;
    classDef process fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,rx:5,ry:5;
    classDef linear fill:#e0f2f1,stroke:#00695c,stroke-width:2px,stroke-dasharray: 5 5;
    classDef solver fill:#fff3e0,stroke:#ef6c00,stroke-width:4px;
    classDef decision fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,rx:5,ry:5,diamond;
    classDef output fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,rx:5,ry:5;

    %% --- 1. 输入阶段 ---
    Start(开始: 输入参数) --> Params[设定车辆参数<br/>m, Iz, lf, lr, Cf, Cr, mu]
    Params --> Inputs[设定工况输入<br/>纵向车速 Vx<br/>前轮转角 delta_f, 后轮转角 delta_r]
    class Start,Params,Inputs input

    %% --- 2. 初始猜测阶段 (线性模型) ---
    Inputs --> LinearCall[调用线性模型函数<br/>steady_state_based_on_linear_model]
    
    subgraph LinearModel ["阶段一：获取初始猜测值 (Linear Model)"]
        direction TB
        LinearCall --> LinAssumption[假设: 小角度近似 & 轮胎力线性<br/>Fy = C * alpha]
        LinAssumption --> LinCalc[代入线性代数公式直接求解<br/>r = G * delta / 1+K*v^2]
        LinCalc --> LinRes[得到线性解:<br/>Vy_lin, r_lin]
    end
    class LinearModel linear
    
    LinRes --> SetX0[将线性解设为初值 x0]
    class SetX0 process

    %% --- 3. 非线性求解阶段 ---
    SetX0 --> FsolveStart(启动 fsolve 数值求解器)
    
    subgraph NonlinearSolver ["阶段二：非线性迭代求解 (fsolve / Newton Method)"]
        direction TB
        FsolveStart --> Iteration[当前迭代状态变量: Vy, r]
        
        Iteration --> Step1[步骤 1: 计算几何侧偏角 alpha<br/>含 arctan 非线性项]
        
        Step1 --> Step2[步骤 2: 计算轮胎侧向力 Fy<br/>使用 Pacejka 魔术公式]
        
        Step2 --> Step3[步骤 3: 代入车辆平衡方程]
        
        Step3 --> EqCheck[计算残差 Residuals:<br/>1. 侧向力合力误差<br/>2. 横摆力矩合力误差]
        
        EqCheck --> IsConverged{残差 < 容差?}
        
        IsConverged -- 否 (No) --> Jacobian[计算梯度/雅可比矩阵]
        Jacobian --> Update[修正 Vy, r]
        Update -.-> Iteration
        
        IsConverged -- 是 (Yes) --> Success[迭代收敛]
    end
    class NonlinearSolver solver
    class IsConverged decision

    %% --- 4. 输出阶段 ---
    Success --> ResultCalc[计算附加状态<br/>侧滑角 beta = arctan Vy/Vx]
    ResultCalc --> Output(输出最终结果:<br/>Vy, r, beta, success_flag)
    class Output output
```

## 参数对齐
> Pacejka模型的小角度刚度与线性模型参数需要匹配，不然会导致求解困难且失去对比意义。

Pacejka模型的初始侧偏刚度（ $\alpha=0$ 处的导数）为：
$$
k_\alpha = \left. \frac{dF_y}{d\alpha} \right|_{\alpha=0} = B \cdot C \cdot D
$$
其中：
+ $D = \mu \cdot F_z$ （峰值因子）
+ $C$ （形状因子）
+ $B$ （刚度因子）

根据这个关系：
$$
C_\alpha = B \cdot C \cdot D
$$
+ 假设我们已经知道侧偏刚度$C_\alpha$，然后$D = \mu \cdot F_z$，只需要知道$B$和$C$其中任意一个就行；
+ 或者我们已经拟合了魔术公式的参数，直接相乘得到$C_\alpha$就行。

# 结果分析


# 代码
```python

```




