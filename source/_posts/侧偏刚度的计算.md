---
title: 侧偏刚度的计算
date: 2025-11-22 11:14:35
cover: https://cdn.jsdelivr.net/gh/xiaoyuewhut/image@main/20251122124428639.png
tags:
- 轮胎
categories:
- 车辆动力学
---

# 前言
今天在写论文的时候，又突然想起来了之前的一个疑问：**轮胎的侧偏刚度 Cornering Stiffness $C_\alpha$到底是什么含义**？

# 刷子模型
$$
F_y = \begin{cases}
-C_\alpha z + \dfrac{C_\alpha^2}{2\xi \mu F_z} |z|z - \dfrac{C_\alpha^3}{27 \xi^2 \mu^2 F_z^2} z^3, & |\alpha| < \alpha_{sl} \\
-\xi \mu F_z \operatorname{sgn} \alpha, & |\alpha| \geq \alpha_{sl}
\end{cases}
$$

$$
z = \tan \alpha
$$

$$
\alpha_{sl} = \arctan \dfrac{3 \xi \mu F_z}{C_\alpha}
$$

因为侧偏刚度只在线性区有意义，所以单独拎出来：
$$
F_y = -C_\alpha z + \dfrac{C_\alpha^2}{2\xi \mu F_z} |z|z - \dfrac{C_\alpha^3}{27 \xi^2 \mu^2 F_z^2} z^3
$$
在这个公式中，正的轮胎侧偏角$\alpha$产生负的轮胎力$F_y$

求偏导
$$
\dfrac{\partial F_y}{\partial \alpha} = \dfrac{\partial F_y}{\partial z} \cdot \dfrac{\partial z}{\partial \alpha}
$$

## 步骤1：求 $\dfrac{\partial z}{\partial \alpha}$
直接对 $z = \tan \alpha$ 求导：
$$
\dfrac{\partial z}{\partial \alpha} = \sec^2 \alpha = 1 + \tan^2 \alpha = 1 + z^2
$$

## 步骤2：求 $\dfrac{\partial F_y}{\partial z}$
对线性区表达式逐项求导：
$$
F_y = -C_\alpha z + \dfrac{C_\alpha^2}{2\xi \mu F_z} |z|z - \dfrac{C_\alpha^3}{27 \xi^2 \mu^2 F_z^2} z^3
$$

- 第一项：$\dfrac{\partial}{\partial z}(-C_\alpha z) = -C_\alpha$
- 第二项（注意绝对值处理）：$\dfrac{\partial}{\partial z}\left(\dfrac{C_\alpha^2}{2\xi \mu F_z} |z|z\right) = \dfrac{C_\alpha^2}{\xi \mu F_z} |z|$
- 第三项：$\dfrac{\partial}{\partial z}\left(-\dfrac{C_\alpha^3}{27 \xi^2 \mu^2 F_z^2} z^3\right) = -\dfrac{C_\alpha^3}{9 \xi^2 \mu^2 F_z^2} z^2$

合并得：
$$
\dfrac{\partial F_y}{\partial z} = -C_\alpha + \dfrac{C_\alpha^2}{\xi \mu F_z} |z| - \dfrac{C_\alpha^3}{9 \xi^2 \mu^2 F_z^2} z^2
$$

## 步骤3：结论
$$
\dfrac{\partial F_y}{\partial \alpha} = \dfrac{\partial F_y}{\partial z} \cdot \dfrac{\partial z}{\partial \alpha}
$$

代入得：
$$
\dfrac{\partial F_y}{\partial \alpha} = \left(-C_\alpha + \dfrac{C_\alpha^2}{\xi \mu F_z} |z| - \dfrac{C_\alpha^3}{9 \xi^2 \mu^2 F_z^2} z^2\right) \cdot (1 + z^2)
$$

非常清晰地得出结论，当$\alpha = 0$的时候，$\partial F_y / \partial \alpha = - C_\alpha$，意思是$C_\alpha$**表示轮胎力曲线在原点处的斜率**。

# 新的疑问
对于每一个特定的垂向载荷，都存在一条对应的$F_y - \alpha$曲线，既然$C_\alpha$**表示轮胎力曲线在原点处的斜率**，那么这个轮胎力曲线到底是哪条负载情况下的曲线呢？

>一种答案是：$C_\alpha$本身就是$F_z$的函数，即$C_\alpha = C_\alpha(F_z)$。

所以我们可以用用垂向载荷的二次函数来近似：
$$
C_\alpha(F_z) = c_1 F_z + c_2 F_z^2
$$

或者或更一般的形式：
$$
C_\alpha(F_z) = a_1 \sin (2 \arctan \dfrac{F_z}{a_2})
$$
有魔术公式那个味儿。

# CarSim建模
## 现有数据
![](https://cdn.jsdelivr.net/gh/xiaoyuewhut/image@main/3b71954d8638f9b96fbbce727bd3c7a5.png)
也就是说单个轮胎的侧骗刚度是：-9282.8 / 2 = -4641.4 N/deg。
这是厂商给的实际轮胎数据，我们要在carsim中正确的建模，一开始的数据是：
```csv
0,2819.41,5638.82,8458.24,11277.65,14097.06,16916.47,19735.88,22555.3
0.5,329.58,633.8,909.33,1154.7,1369.28,1552.96,1705.99,1828.89
1,648.04,1246.9,1790,2274.43,2698.83,3062.86,3366.88,3611.83
1.5,945.81,1821.35,2617.08,3328.56,3953.62,4491.51,4942.48,5307.63
2,1215.89,2343.97,3371.97,4293.99,5106.92,5809.37,6401.27,6883.54
2.5,1454.34,2807.04,4043.54,5156.52,6141.82,6997.3,7722.26,8317.22
3,1659.96,3208.03,4627.74,5910.47,7051.03,8046.37,8895.04,9596.91
3.5,1833.72,3548.45,5126.18,6557.19,7835.24,8956.38,9918.31,10720.1
4,1978.06,3832.57,5544.42,7102.92,8500.93,9733.58,10797.72,11691.54
4.5,2096.12,4066.18,5890.26,7556.89,9058.15,10388.36,11543.5,12520.93
5,2191.36,4255.65,6172.44,7929.66,9518.74,10933.28,12168.49,13220.91
5.5,2267.11,4407.27,6399.73,8231.98,9894.93,11381.59,12686.5,13805.43
6,2326.48,4526.89,6580.35,8474.05,10198.51,11746.24,13111.19,14288.52
6.5,2372.2,4619.73,6721.71,8665.16,10440.3,12039.24,13455.47,14683.59
7,2406.62,4690.32,6830.31,8813.51,10629.93,12271.41,13731.04,15002.96
7.5,2431.75,4742.52,6911.69,8926.16,10775.81,12452.25,13948.28,15257.68
8,2449.26,4779.59,6970.57,9009.16,10885.14,12589.98,14116.27,15457.46
8.5,2460.54,4804.23,7010.91,9067.59,10964.04,12691.63,14242.79,15610.74
9,2466.74,4818.71,7036,9105.72,11017.68,12763.18,14334.52,15724.78
9.5,2468.82,4824.88,7048.58,9127.13,11050.39,12809.64,14397.12,15805.77
10,2467.54,4824.29,7050.91,9134.78,11065.79,12835.26,14435.38,15859
10.5,2463.55,4818.2,7044.88,9131.13,11066.91,12843.59,14453.33,15888.94
11,2457.38,4807.65,7032.05,9118.23,11056.28,12837.6,14454.37,15899.37
11.5,2449.45,4793.52,7013.68,9097.78,11036,12819.78,14441.37,15893.5
12,2440.13,4776.5,6990.86,9071.2,11007.82,12792.23,14416.71,15874.03
12.5,2429.71,4757.19,6964.46,9039.66,10973.21,12756.69,14382.43,15843.24
13,2418.42,4736.06,6935.2,9004.14,10933.38,12714.62,14340.23,15803.06
13.5,2406.46,4713.53,6903.71,8965.44,10889.36,12667.24,14291.54,15755.13
14,2394,4689.91,6870.46,8924.25,10842,12615.6,14237.56,15700.82
14.5,2381.18,4665.49,6835.89,8881.12,10792.02,12560.55,14179.31,15641.29
15,2368.09,4640.49,6800.34,8836.52,10739.99,12502.81,14117.64,15577.54
15.5,2354.84,4615.09,6764.08,8790.84,10686.43,12442.99,14053.28,15510.4
16,2341.5,4589.44,6727.37,8744.41,10631.75,12381.61,13986.82,15440.58
16.5,2328.13,4563.69,6690.39,8697.5,10576.3,12319.09,13918.79,15368.66
17,2314.78,4537.92,6653.31,8650.33,10520.36,12255.79,13849.62,15295.17
17.5,2301.5,4512.23,6616.26,8603.08,10464.17,12192.01,13779.66,15220.53
18,2288.3,4486.68,6579.35,8555.92,10407.94,12128,13709.23,15145.11
18.5,2275.23,4461.33,6542.67,8508.96,10351.84,12063.98,13638.59,15069.2
19,2262.31,4436.23,6506.29,8462.3,10296,12000.11,13567.94,14993.07
19.5,2249.54,4411.41,6470.28,8416.05,10240.54,11936.55,13497.46,14916.94
20,2236.94,4386.91,6434.68,8370.25,10185.54,11873.42,13427.32,14840.99
20.5,2224.53,4362.74,6399.52,8324.97,10131.08,11810.8,13357.63,14765.37
21,2212.32,4338.92,6364.84,8280.26,10077.23,11748.79,13288.49,14690.22
21.5,2200.29,4315.46,6330.66,8236.14,10024.04,11687.45,13220,14615.63
22,2188.47,4292.38,6296.99,8192.64,9971.53,11626.82,13152.21,14541.7
22.5,2176.85,4269.68,6263.85,8149.78,9919.75,11566.97,13085.19,14468.5
23,2165.43,4247.36,6231.25,8107.58,9868.7,11507.9,13018.98,14396.08
23.5,2154.22,4225.42,6199.18,8066.04,9818.42,11449.65,12953.62,14324.5
24,2143.21,4203.87,6167.65,8025.17,9768.9,11392.24,12889.12,14253.78
24.5,2132.4,4182.7,6136.65,7984.96,9720.15,11335.67,12825.51,14183.97
25,2121.78,4161.9,6106.2,7945.43,9672.17,11279.95,12762.8,14115.07
26,2121.78,4161.9,6106.2,7945.43,9672.17,11279.95,12762.8,14115.07
```
把几条曲线画出来
![](https://cdn.jsdelivr.net/gh/xiaoyuewhut/image@main/20251122140405263.png)
这个数据明显就有问题：
1. 垂向载荷不匹配
6500 kg负载对应的垂向载荷应该为$6500 \times 9.81 = 63765 \text{N}$，但第一行的垂向载荷数据最大只有22555 N，也就是2300 kg。第一行数据也和曲线最大值不匹配，除非$\mu$比较大。
2. 侧偏刚度不匹配
侧偏刚度目标值是4641.4 N/deg，实际计算值是3132 N/deg（@19735.88 N载荷）

要计算每条曲线在零点处的斜率，最可靠的方法是在零点附近取一个微小的区间，利用这个区间内的 data points 进行线性回归，其斜率即为所求。以下是代码：
```python
def calculate_zero_slope(x, y):
    """
    在零点附近计算曲线的斜率。
    
    参数:
    x (pd.Series): 自变量 (侧偏角)
    y (pd.Series): 因变量 (侧向力)
    
    返回:
    float: 零点处的斜率
    """
    # 找到零点附近的点，这里选择 x 在 [-2, 2] 范围内的数据
    mask = (x >= -2) & (x <= 2)
    x_near_zero = x[mask].values.reshape(-1, 1)
    y_near_zero = y[mask].values
    
    # 如果没有足够的数据点，返回 NaN
    if len(x_near_zero) < 2:
        return np.nan
    
    # 使用线性回归拟合
    model = LinearRegression()
    model.fit(x_near_zero, y_near_zero)
    
    return model.coef_[0]
```
>结果为：
各垂向载荷下的零点斜率 (N/°):
Fz = 2819.41 N: 591.34
Fz = 5638.82 N: 1140.99
Fz = 8458.24 N: 1643.00
Fz = 11277.65 N: 2094.40
Fz = 14097.06 N: 2493.54
Fz = 16916.47 N: 2839.58
Fz = 19735.88 N: 3132.29
Fz = 22555.3 N: 3371.95

## 基于Magic Formula模型的参数反推
CarSim使用Pacejka Magic Formula模型:
$$
F_y = D \cdot \sin \left( C \cdot \arctan \left( B \cdot \alpha - E \cdot \left( B \cdot \alpha - \arctan \left( B \cdot \alpha
\right)
\right)
\right)
\right)
$$
其中：
+ $B = BCD / C / D$（刚度因子）
+ $C = $形状因子，通常1.0-1.3
+ $D = \mu F_z$，峰值因子
+ E，曲率因子，通常-3到0
侧偏刚度（小角度时的斜率）≈ BCD

### 确定刚度和载荷的关系
根据前面的侧偏刚度与垂向载荷的经验关系：
$$
C_\alpha = c_1 F_z + c_2 F_z^2
$$
我们现在已经有一个target point(63765, 4641.4)，但确定两个参数需要两个已知点，就先假设另一个点吧：(40000, 2500)

```python
Fz1 = 40000
Ca1 = 3500
Fz2 = 63765
Ca2 = 4641.4

c1 = (Ca2*Fz1 - Ca1*Fz2) / (Fz2*Fz1**2 - Fz1*Fz2**2)
c2 = (Ca1 - c1*Fz1) / (Fz1**2)
```
## 生成数据

```python
import numpy as np
from magic_formula import magic_formula
import pandas as pd

def calculate_stiffness(Fz, c1, c2):
    """计算给定垂向载荷下的侧偏刚度"""
    return c1 * Fz + c2 * Fz**2

def save_with_pandas(data_matrix):
    # 解析数据
    rows = [line.split(',') for line in data_matrix]
    df = pd.DataFrame(rows[1:], columns=rows[0])  # 第一行作为列名
    
    filename = "TireFy_pred.csv"

    df.to_csv(filename, index=False)
    print(f"✅ 已保存: {filename}")

def generate_tire_data(Fz_target, Ca_target, alpha_max, alpha_step=0.5):
    """生成单一载荷下的轮胎数据"""
    C = 1.4
    E = -50
    mu = 0.85
    
    D = mu * Fz_target
    BCD = Ca_target * 180 / np.pi
    B = BCD / (C * D)
    
    alphas = np.arange(0, alpha_max + alpha_step/2, alpha_step)
    fys = []
    
    for alpha in alphas:
        fy = magic_formula(alpha, B, C, D, E)
        fys.append(fy)
    
    return alphas, fys

# ==================== 主程序 ====================
if __name__ == "__main__":
    # 1. 定义垂向载荷列表（8个载荷点，单位N）
    #    覆盖从半载到超载的工况
    Fz_list = np.array([
        28194,   # ~2875kg (参考原数据起始点)
        40000,   # ~4075kg
        55000,   # ~5600kg
        63765,   # 6500kg (目标载荷)
        75000,   # ~7645kg
        85000,   # ~8660kg
        95000,   # ~9680kg
        105000   # ~10700kg
    ])
    
    # 2. 计算刚度-载荷关系系数
    #    使用两个基准点：(40000N, 3500) 和 (63765N, 4641.4)
    Fz_ref = np.array([40000, 63765])
    Ca_ref = np.array([2500, 4641.4])
    A = np.array([[Fz_ref[0], Fz_ref[0]**2], 
                  [Fz_ref[1], Fz_ref[1]**2]])
    b = np.array([Ca_ref[0], Ca_ref[1]])
    c1, c2 = np.linalg.solve(A, b)
    
    # 3. 生成角度列表
    alphas = np.arange(0, 26.5, 0.5)
    
    # 4. 构建数据矩阵
    #    第一行为垂向载荷（第一列占位符0）
    #    后续行为：角度, 载荷1侧向力, 载荷2侧向力, ...
    data_matrix = []
    
    # 表头
    header = ["0"] + [f"{Fz:.2f}" for Fz in Fz_list]
    data_matrix.append(",".join(header))
    
    # 预计算所有载荷下的侧向力数据
    all_fys = []
    for Fz in Fz_list:
        Ca_target = calculate_stiffness(Fz, c1, c2)
        _, fys = generate_tire_data(Fz, Ca_target, alpha_max=alphas[-1])
        all_fys.append(fys)
    
    # 数据行
    for i, alpha in enumerate(alphas):
        row = [f"{alpha:.1f}"]
        for j in range(len(Fz_list)):
            row.append(f"{all_fys[j][i]:.2f}")
        data_matrix.append(",".join(row))
    
    # 5. 输出CSV格式
    print("CarSim格式轮胎数据（横向力-侧偏角）:")
    print("=" * 80)
    for line in data_matrix:
        print(line)
    
    # 6. 验证目标点
    print("\n" + "=" * 80)
    print(f"目标载荷63765N下的侧偏刚度验证:")
    Ca_check = calculate_stiffness(63765, c1, c2)
    print(f"计算刚度 = {Ca_check:.2f} N/deg")
    print(f"目标刚度 = 4641.4 N/deg")
    print(f"误差 = {abs(Ca_check-4641.4)/4641.4*100:.2f}%")

    # 7. 可视化验证
    save_with_pandas(data_matrix)
    from cal_stiffness import draw_tire_force_curve
    draw_tire_force_curve("TireFy_pred.csv")
```
![](https://cdn.jsdelivr.net/gh/xiaoyuewhut/image@main/20251124153702520.png)
因为魔术公式参数对曲线形状影响比较大，所以只能一点点慢慢调，至于是不是跟实际符合，谁知道呢。。。。。

