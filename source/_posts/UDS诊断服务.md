---
title: UDS诊断服务
date: 2025-11-20 15:13:23
tags:
categories: 自动驾驶
---
# 6 大类，26种服务
每个服务都有自己的Service Identifier。

比较常见的，我记得比较清楚的：
10、27、3E、14、31、34、35
我记得不清楚的，但是必须加强记忆的：
11、28、22、2E、19、2F、36、37、38

{% asset_img uds.PNG "UDS服务概览" %}

# 不同会话支持的服务
{% asset_img 服务.PNG "会话" %}
Deafult：默认会话
Programming：编程会话
Extended：扩展会话
Boot Code：引导加载程序代码
App Code：应用程序代码

# 功能寻址和物理寻址
作为诊断设备既可以与所有的ECU一起沟通，也可以指定某一个ECU单独沟通。所以寻址方式就有功能寻址（Functionally Addressed）和物理寻址（Physically Addressed）两种。
  1. 功能寻址：即广播诊断请求Request，同时等待总线上的ECU给与响应。
  2. 物理寻址：指定发送特定诊断请求Request，等待指定ECU给与响应。

# 27 安全访问逻辑
安全访问服务，主要功能是为了通过诊断安全地访问服务端，也就是ECU，而设置的一层保护机制。安全访问服务用于修改存储在内存中的 ECU 数据，在此之前，用户首先必须通过该服务授予访问权限。此服务的目的是提供一种访问信息和/或诊断服务的方法，这些服务因安全、排放或安全原因而受到限制。比如一些用于将例程或信息下载/上传到服务器中，并从服务器中读取特定的内存位置的诊断服务可能需要安全访问。因为下载到服务器中的不当程序或信息无疑可能会损害ECU，或危及车辆遵守排放、违反安全或安保标准。安全访问的机制通过使用种子和密钥来实现。
1. 客户端首先发送请求种子的诊断请求
2. 服务端收到请求后，计算一个随机种子通过诊断响应发送给客户端
3. 客户端收到种子后，使用定义好的算法计算出密钥，然后通过诊断请求发送给服务端
4. 服务端收到密钥后，与自己计算的密钥作对比，如果一致，验证通过，如果不一致，验证失败

{% asset_img 27.PNG "27服务" %}

# ECU 软件刷写流程
{% asset_img ecu.PNG "软件刷写流程" %}

1. `10 02` 进入编程会话
2. `27` 服务请求seed，返回key，安全访问
3. `31` 例程控制
  - 例程控制的请求格式为：`SID+SF+RID+非必须选项`；
  - 例程控制的正响应格式为：`（SID+40）+SF+RID+非必须选项`。
4. `34` 请求下载
5. `36` 数据传输
6. `37` 退出传输
